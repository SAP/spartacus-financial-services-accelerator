<h3 class="heading-headline">{{ 'premiumCalendar.premiumCalendar' | cxTranslate }}</h3>
<ng-container *ngIf="policies$ | async as policies; else noPolicies">
  <ng-container *ngIf="policiesLoaded$ | async; else loading">
    <ng-container *ngIf="policies?.insurancePolicies?.length > 0; else noPolicies">
      <div class="container-fluid d-none d-lg-block"> <!-- Desktop Layout-->
        <div class="gradient-heading row">
          <h3 class="col"> {{ 'fscommon.policy.policy' | cxTranslate }} </h3>
          <h3 class="col"> {{ 'fscommon.paymentFrequency' | cxTranslate }} </h3>
          <h3 class="col"> {{ 'premiumCalendar.dueDate' | cxTranslate }} </h3>
          <h3 class="col"> {{ 'fscommon.premium' | cxTranslate }} </h3>
          <h3 class="col"> {{ 'fscommon.paymentMethod' | cxTranslate }} </h3>
        </div>
        <div *ngFor="let policy of policies.insurancePolicies">
          <div class="premium-data-row row" (click)="policy.opened=!policy.opened" [ngClass]="{'clickable': policy.billingData?.length > 1, 'active':policy.opened}">
            <div class="col">
              <div class=row>
                <div class="col-4">
                  <div class="images__wrapper">
                    <img class="images__size" [src]="getBaseUrl()+ policy.mainProduct.coverageProduct.images[0]?.url" alt="">
                  </div>
                </div>
                <div class="col-8">
                  {{policy.categoryData?.name}} <br>
                  {{policy.contractNumber}}
                </div>
              </div>
            </div>
            <div class="col">
              {{policy.paymentFrequency}}
            </div>
            <div class="col" [ngClass]="(policy.billingData[0]?.paymentStatus == 'Overdue')?'warn':'notice'">
              {{policy.billingData[0]?.billingDate}}
              <div class="warn" *ngIf="policy.billingData[0]?.paymentStatus == 'Overdue'">
                {{ 'premiumCalendar.overdue' | cxTranslate }}
              </div>
            </div>
            <div class="col" [ngClass]="(policy.billingData[0]?.paymentStatus == 'Overdue')?'warn':'notice'">
              {{policy.policyPremium?.formattedValue}}
            </div>
            <div class="col">
              <ng-container *ngIf="policy.paymentMethod; else NA">
                {{policy.paymentMethod.cardType?.code| uppercase }} {{policy.paymentMethod?.cardNumber }}
              </ng-container>
            </div>
          </div>
          <div class="accordion row" *ngIf="policy.billingData?.length > 1;"[ngClass]="policy.opened ? 'opened' : ''" >
            <div class="container-fluid">
              <ng-container *ngFor="let dueDate of policy.billingData | slice:1">
                <div class="row">
                  <div class="col"></div>
                  <div class="col"></div>
                  <div class="col color-dot">
                    {{dueDate.billingDate}}
                  </div>
                  <div class="col color-dot">
                    {{dueDate.paymentAmount}}
                  </div>
                  <div class="col"></div>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
      </div><!-- End of Desktop Layout-->
      <div class="container-fluid"><!-- Mobile layout-->
        <div class="row">
          <ng-container *ngFor="let policy of policies.insurancePolicies">
            <div class="col-12 col-sm-6 d-block d-lg-none">
              <div class="cards__wrapper">
                <div class="cards__title cards__title--gradient-background">
                  <span class="images images__wrapper images__wrapper--white-bck">
                    <img class="images__size" [src]="getBaseUrl()+policy.mainProduct.coverageProduct.images[0]?.url" alt="">
                  </span>
                  <h4 class="cards__caption cards__caption--color-white">
                    {{policy.categoryData?.name}}
                  </h4>
                  <div class="cards__info cards__info--color-white">
                    {{policy.policyNumber}}
                  </div>
                </div>
                <div class="cards__details-wrapper cards__details-wrapper--grey">
                  <div class="cards__data border-bottom-grey">
                    <span class="title">
                      {{ 'fscommon.paymentFrequency' | cxTranslate }}
                    </span>
                    <span class="value">
                      {{policy.paymentFrequency}}
                    </span>
                  </div>
                  <div class="container cards__data border-bottom-grey" (click)="policy.opened=!policy.opened" [ngClass]="{'clickable': policy.billingData.length > 1, 'active':policy.opened}">
                    <div class="row">
                      <div class="col-6">
                        <div class="title">
                            <div class="cell-text text-left d-flex justify-content-around">{{ 'premiumCalendar.dueDate' | cxTranslate }}</div>
                        </div>
                        <div class="title text-left d-flex justify-content-around" [ngClass]="(policy.billingData[0]?.paymentStatus == 'Overdue')?'warn':'notice'">
                          {{policy.billingData[0]?.billingDate}}
                          <div class="warn" *ngIf="policy.billingData[0]?.paymentStatus == 'Overdue'">{{ 'premiumCalendar.overdue' | cxTranslate }}</div>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="title text-left d-flex justify-content-around">
                          <div class="cell-text">
                            {{ 'fscommon.premium' | cxTranslate }}
                          </div>
                        </div>
                        <div class="title text-left d-flex justify-content-around" [ngClass]="(policy.billingData[0]?.paymentStatus == 'Overdue')?'warn':'notice'">
                          {{policy.billingData[0]?.paymentAmount}}                                   
                        </div>
                      </div>
                    </div>
                  </div>
                  <ng-container *ngIf="policy.billingData.length > 1;">
                    <div class="accordion container" [ngClass]="policy.opened ? 'opened' : ''">
                      <ul class="list-data">
                        <ng-container *ngFor="let dueDate of policy.billingData | slice:1">
                            <li class="row list-data__list-item border-bottom-grey">
                              <div class="col-6 text-left d-flex justify-content-around">
                                {{dueDate.billingDate}}
                              </div>
                              <div class="col-6 text-left d-flex justify-content-around">
                                {{dueDate.paymentAmount}}
                              </div>
                            </li>
                        </ng-container>
                      </ul>
                    </div>
                  </ng-container>
                  <div class="cards__data">
                    <span class="title">
                      {{ 'fscommon.paymentMethod' | cxTranslate }}
                    </span>
                    <ng-container *ngIf="policy.paymentMethod; else NA">
                      {{policy.paymentMethod.cardType?.code| uppercase }} {{policy.paymentMethod?.cardNumber }}
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>  
      </div>
    </ng-container>
  </ng-container>
</ng-container>
<ng-template #NA>
  {{ 'fscommon.notAvailable' | cxTranslate }}
</ng-template>
<ng-template #loading>
  <cx-spinner></cx-spinner>
</ng-template>
<ng-template #noPolicies>
  <p>
    {{ 'premiumCalendar.noPremiumsAwaitingPayment' | cxTranslate }}
  </p>
</ng-template>