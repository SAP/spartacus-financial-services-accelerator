<ng-container *ngIf="component$ | async as component">
    <ng-container *ngIf="!anonymous$; else anonymousLogin">
        <ng-container *ngIf="policiesLoaded$ | async; else loading">
            <ng-container *ngIf="policies$ | async as policies">
                <div class="review__wrapper">
                    <ng-container *ngIf="policies?.insurancePolicies?.length > 0; else noPolicies">
                        <div class="my-policies">
                            <h2 class="fs-items-title">{{ 'policy.viewPolicies' | cxTranslate }}</h2>
                            <ul>
                                <ng-container *ngTemplateOutlet="policiesList; context:{policies: policies, max: (allPoliciesDisplayed$ ? policies?.insurancePolicies?.length : component.numberOfPoliciesToDisplay)}"></ng-container>
                            </ul>
                            <ng-container *ngIf = "policies?.insurancePolicies?.length > component.numberOfPoliciesToDisplay">
                                <ng-container *ngTemplateOutlet="showAllPoliciesButton context: {showAll: (allPoliciesDisplayed$ ? false : true)}"></ng-container>
                            </ng-container>  
                        </div>
                    </ng-container>
                </div>
            </ng-container>
        </ng-container>
    </ng-container>
</ng-container>

<ng-template #policiesList let-policies="policies" let-max="max">
    <li *ngFor="let policy of policies.insurancePolicies | slice: 0:max" class="fs-items-item">
        <a routerLink="/my-account/my-policies/{{policy.policyNumber}}/{{policy.contractNumber}}" routerLinkActive="active">
            <div class="fs-items-data-container background-hover-secondary">
                <span class="image-wrapper">
                        <img class="image-item" [src]="getBaseUrl()+policy.mainProduct.coverageProduct.images[0].url" alt="">
                    </span>
                <div class="fs-items-name-number">
                    <span class="fs-items-name">{{policy.categoryData?.name}}</span>
                    <span class="fs-items-number">{{policy.contractNumber}}</span>
                </div>
                    <span class="fs-items-add-infos">{{policy.policyEndDate}}</span>
            </div>
        </a>
    </li>
</ng-template>

<ng-template #showAllPoliciesButton let-showAll="showAll">
    <button class="secondary-button" (click)="showAllPolicies(showAll);">
        {{policyButtonText}}
    </button>
</ng-template>

<ng-template #noPolicies>
    <div class="empty-block">
        <h2 class="title">{{ 'policy.viewPolicies' | cxTranslate }}</h2>
        <p class="content">- {{ 'policy.finishQuoteToGetPolicy' | cxTranslate }}</p>
    </div>
</ng-template>

<ng-template #anonymousLogin>
    <button routerLink="/login" class="secondary-button">{{ 'policy.viewYourPolicies' | cxTranslate }}</button>
</ng-template>

<ng-template #loading>
    <cx-spinner></cx-spinner>
</ng-template>