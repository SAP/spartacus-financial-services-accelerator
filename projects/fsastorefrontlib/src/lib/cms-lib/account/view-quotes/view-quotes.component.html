<ng-container *ngIf="component$ | async as component">
    <div *ngIf="!anonymous$; else anonymousLogin">
        <ng-container *ngIf="quotesLoaded$ | async; else loading">
            <div *ngIf="quotes$ | async as quotes"  class="review__wrapper">
                <div class="review__quote" *ngIf="quotes?.insuranceQuotes?.length > 0; else noQuotes">
                    <div class="my-quotes">
                        <h2 class="my-quotes__title">{{ 'quote.retrieveQuotes' | cxTranslate }}</h2>
                            <ul>
                                <ng-container *ngTemplateOutlet="quoteList; context:{quotes: quotes, max: (allQuotesDisplayed$ ? quotes?.insuranceQuotes?.length : component.numberOfQuotesToDisplay)}"></ng-container>
                            </ul>
                            <div *ngIf = "quotes?.insuranceQuotes?.length > component.numberOfQuotesToDisplay">
                                <ng-container *ngTemplateOutlet="showAllQuotesButton context: {showAll: (allQuotesDisplayed$ ? false : true)}"></ng-container>
                            </div>   
                    </div>
                </div>
            </div>
        </ng-container>
    </div>
</ng-container>

<ng-template #quoteList let-quotes="quotes" let-max="max">
    <div *ngFor="let quote of quotes.insuranceQuotes | slice: 0:max">
        <li class="my-quotes__my-quote">
            <div class="my-quotes__data-container">
                <span class="images images__wrapper">
                        <img class="images__size" [src]="getBaseUrl()+quote.defaultCategory?.image.url" alt="">
                        </span>
                <div class="my-quotes__name-number">
                    <span class="my-quotes__name">{{quote.planName}}</span>
                    <span class="my-quotes__number">{{quote.quoteId}}</span>
                </div>
                <span class="my-quotes__add-infos">
                        {{quote.quoteWorkflowStatus?.code}}
                </span>
            </div>
        </li>
    </div>
</ng-template>

<ng-template #showAllQuotesButton let-showAll="showAll">
        <button class="primary-button primary-button__default primary-button__home" (click)="showAllQuotes(showAll);">
                {{quoteButtonText}}
            </button>
</ng-template>

<ng-template #noQuotes>
        <div class="none-quote">
            <h2 class="none-quote__title">{{ 'quote.viewQuotes' | cxTranslate }}</h2>
            <p class="none-quote__content">- {{ 'quote.getQuoteBySelecting' | cxTranslate }}</p>
        </div>
</ng-template>

<ng-template #anonymousLogin>
    <a routerLink="/login">
        <button class="primary-button primary-button__default primary-button__home">{{ 'quote.viewYourQuotes' | cxTranslate }}</button>
    </a>
</ng-template>

<ng-template #loading>
    <cx-spinner></cx-spinner>
</ng-template>